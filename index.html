<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Wallet Phase 2</title>

<style>
body {
  background:#7b0000;
  color:white;
  font-family: system-ui;
  text-transform: uppercase;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}

.card {
  text-align:center;
}

button {
  background:white;
  color:#1d4ed8;
  border:none;
  padding:16px 24px;
  font-size:18px;
  font-weight:bold;
  border-radius:12px;
  margin-top:12px;
}

#info {
  margin-top:20px;
  line-height:1.6;
}
</style>
</head>

<body>
<div class="card">
  <button id="connect">CONNECT WALLET</button>

  <div id="info">
    NOT CONNECTED
  </div>

  <button id="disconnect" style="display:none;">DISCONNECT</button>
</div>

<script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>

<script>
const { Connection, clusterApiUrl, LAMPORTS_PER_SOL } = solanaWeb3;

const connection = new Connection(clusterApiUrl("mainnet-beta"), "confirmed");

const connectBtn = document.getElementById("connect");
const disconnectBtn = document.getElementById("disconnect");
const info = document.getElementById("info");

async function updateUI(pubkey) {
  const balance = await connection.getBalance(pubkey);

  info.innerHTML =
    "CONNECTED<br>" +
    "ADDR: " + pubkey.toString().slice(0,4) + "..." + pubkey.toString().slice(-4) + "<br>" +
    "BALANCE: " + (balance / LAMPORTS_PER_SOL).toFixed(3) + " SOL";

  disconnectBtn.style.display = "block";
}

connectBtn.onclick = async () => {
  if (!window.solana || !window.solana.isPhantom) {
    info.innerText = "PHANTOM NOT FOUND";
    return;
  }

  try {
    const res = await window.solana.connect();
    localStorage.setItem("connected", "true");
    await updateUI(res.publicKey);
  } catch {
    info.innerText = "CONNECTION REJECTED";
  }
};

disconnectBtn.onclick = async () => {
  await window.solana.disconnect();
  localStorage.removeItem("connected");
  info.innerText = "NOT CONNECTED";
  disconnectBtn.style.display = "none";
};

// AUTO RECONNECT
window.addEventListener("load", async () => {
  if (localStorage.getItem("connected") === "true" && window.solana?.isPhantom) {
    try {
      const res = await window.solana.connect({ onlyIfTrusted: true });
      updateUI(res.publicKey);
    } catch {}
  }
});
</script>
</body>
</html>
