<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Solana Mobile Launchpad</title>

<!-- Buffer (stable CDN) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/buffer/6.0.3/buffer.min.js"></script>
<script>window.Buffer = buffer.Buffer;</script>

<style>
body { background:#0a0a12; color:white; font-family:system-ui; margin:0; padding:16px }
.card { max-width:520px; margin:auto; background:#161625; padding:20px; border-radius:20px }
button { width:100%; padding:14px; border-radius:14px; border:none; font-size:16px; font-weight:600; cursor:pointer }
#connectBtn { background:#7c3aed }
.wallet-option { background:#1e1e30; margin-bottom:10px }
#walletModal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); align-items:center; justify-content:center }
.modal { background:#161625; padding:20px; border-radius:16px; width:90%; max-width:320px }
.hidden { display:none }
</style>
</head>

<body>
<div class="card">
  <button id="connectBtn">Connect Wallet</button>

  <div id="walletInfo" class="hidden">
    <p id="addr"></p>
    <p id="bal"></p>
  </div>

  <div id="launchpadUI" class="hidden">
    <form id="launchForm">
      <input id="name" placeholder="Token Name" required/>
      <input id="symbol" placeholder="Symbol" required/>
      <input id="supply" type="number" value="1000000" required/>
      <input id="imageInput" type="file" accept="image/*" required/>
      <button type="submit" style="background:#10b981">Launch Token</button>
    </form>
  </div>

  <div id="status"></div>
</div>

<!-- Wallet selector -->
<div id="walletModal">
  <div class="modal">
    <h3>Select Wallet</h3>
    <button class="wallet-option" data-wallet="phantom">Phantom</button>
    <button class="wallet-option" data-wallet="okx">OKX</button>
    <button class="wallet-option" data-wallet="solflare">Solflare</button>
  </div>
</div>

<script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@solana/spl-token@0.3.9/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@metaplex-foundation/mpl-token-metadata@2.13.0/dist/index.iife.js"></script>

<script>
const { Connection, clusterApiUrl, LAMPORTS_PER_SOL } = solanaWeb3;
let connection = new Connection(clusterApiUrl("devnet"));
let wallet, account;

const modal = document.getElementById("walletModal");

function getWalletByName(name) {
  if (!window.solana?.isWalletStandard) return null;
  return window.solana;
}

document.getElementById("connectBtn").onclick = () => {
  modal.style.display = "flex";
};

document.querySelectorAll(".wallet-option").forEach(btn => {
  btn.onclick = async () => {
    modal.style.display = "none";
    wallet = getWalletByName(btn.dataset.wallet);
    if (!wallet) return alert("Wallet not found");

    const res = await wallet.connect();
    account = res.accounts[0];

    document.getElementById("connectBtn").classList.add("hidden");
    document.getElementById("launchpadUI").classList.remove("hidden");
    document.getElementById("walletInfo").classList.remove("hidden");

    document.getElementById("addr").innerText = account.address.slice(0,4)+"..."+account.address.slice(-4);
    const bal = await connection.getBalance(new solanaWeb3.PublicKey(account.address));
    document.getElementById("bal").innerText = (bal/LAMPORTS_PER_SOL).toFixed(3)+" SOL";
  };
});

document.getElementById("launchForm").onsubmit = async (e) => {
  e.preventDefault();
  document.getElementById("status").innerText = "Uploading metadata...";

  // üîê SAFE BACKEND CALL (YOU MUST IMPLEMENT SERVER)
  const formData = new FormData();
  formData.append("file", imageInput.files[0]);
  formData.append("name", name.value);
  formData.append("symbol", symbol.value);

  const res = await fetch("https://YOUR_BACKEND/upload", {
    method:"POST",
    body:formData
  });

  if (!res.ok) return alert("Backend upload failed");
  const { uri } = await res.json();

  document.getElementById("status").innerText =
    "Metadata uploaded. Token mint logic goes here ‚úÖ";
};
</script>
</body>
</html>
